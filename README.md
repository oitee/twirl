# twirl

## Scope

Twirl is a web app that shortens URLs. It allows users to sign up (verified with reCAPTCHA) and sign-in on the app and create short links by entering their original links. The app ensures protection of passwords by storing them in the database using salted hashing, by using the standard pbkdf2 function (imported from NodeJs' Crypto library). Each short link is uniquely generated. This is done by combining a pseudo-random string (generated by the randomBytes function of NodeJs' Crypto library)  with a counter generated from the PostgreSQL database. 

The app provides for two user-roles: admin and ordinary. Ordinary users can view the list of top 50 links shortened by them, the number of times each such short link has been accessed and an option to enable or disable them. Admin users can access the top 50 short links created by the app; however, an admin user is not given the permission to disable or enable links created by other users. 

The project is accompanied by complete integration tests using Jest framework. The app has been deployed on GCP. It can be accessed here: [twirl.otee.dev](https://twirl.otee.dev/login).

## System Design

This project implements a Model-View-Controller (MVC) architecture. It has two models and two controllers, one each for handling user interactions and for generating short-links. It has a shared view component for displaying shortened links and basic analytics.

## Running the System

As the system uses PostgreSQL deployed on Docker, the relevant Docker container needs to be started:

```bash
docker-compose up
```

The database schema will need to be created using [setup_database.sql](setup_database.sql).

To run the system (environment variables for cookie secret, PostgreSQL connection string, and reCAPTCHA secret will need to be provided):

```bash
COOKIE_SECRET=<secret>  PG_CONNECTION_STRING=postgres://<username>:<password>@localhost:5432/twirl PORT=4001  RECAPTCHA_SECRET=<secret> node app.js 
```
To by-pass reCAPTCHA validation, use 'EXEMPTED' for the environment variable RECAPTCHA_SECRET

To start the system locally, with sample values for cookie secret:

```bash
npm run start_local app.js
```

## Integration tests

To run the tests:

```
npm test

```
